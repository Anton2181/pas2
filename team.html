<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <!DOCTYPE html>
    <html lang="en">

    <head>
        <meta charset="UTF-8">
        <!DOCTYPE html>
        <html lang="en">

        <head>
            <meta charset="UTF-8">
            <!DOCTYPE html>
            <html lang="en">

            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Warsaw Tango Partyka - Team Members</title>
                <link rel="stylesheet" href="style.css">
                <link rel="preconnect" href="https://fonts.googleapis.com">
                <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
                <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap"
                    rel="stylesheet">
                <style>
                    .team-container {
                        display: flex;
                        height: calc(100vh - 48px);
                    }

                    .team-sidebar {
                        width: 320px;
                        /* Increased width for list */
                        background: var(--surface-color);
                        border-right: 1px solid var(--border-color);
                        display: flex;
                        flex-direction: column;
                        overflow-y: auto;
                        position: relative;
                    }

                    .sidebar-header {
                        padding: 16px;
                        border-bottom: 1px solid var(--border-color);
                        font-weight: 600;
                        color: var(--text-primary);
                        position: sticky;
                        top: 0;
                        background: var(--surface-color);
                        z-index: 10;
                        cursor: pointer;
                        transition: background 0.2s;
                    }

                    .sidebar-header:hover {
                        background: var(--surface-hover);
                    }

                    .sidebar-header.selected {
                        background: var(--surface-hover);
                        color: var(--accent-primary);
                        border-left: 3px solid var(--accent-primary);
                    }

                    .member-item {
                        padding: 12px 16px;
                        border-bottom: 1px solid var(--border-color);
                        display: flex;
                        flex-direction: column;
                        gap: 8px;
                        transition: background 0.2s;
                        cursor: pointer;
                        border-left: 3px solid transparent;
                    }

                    .member-item:hover {
                        background: var(--surface-hover);
                    }

                    .member-item.selected {
                        background: var(--surface-hover);
                        border-left: 3px solid var(--accent-primary);
                    }

                    .member-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    }

                    .member-name {
                        font-size: 14px;
                        font-weight: 500;
                        color: var(--text-primary);
                    }

                    .member-role {
                        font-size: 11px;
                        color: var(--text-secondary);
                        background: rgba(0, 0, 0, 0.05);
                        padding: 2px 6px;
                        border-radius: 4px;
                    }

                    .member-controls {
                        display: grid;
                        grid-template-columns: 1fr 1fr 1fr;
                        gap: 8px;
                    }

                    .control-col {
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        gap: 4px;
                    }

                    .col-label {
                        font-size: 10px;
                        color: var(--text-secondary);
                        text-transform: uppercase;
                    }

                    .toggle-square {
                        width: 32px;
                        height: 32px;
                        border-radius: 6px;
                        background: rgba(0, 0, 0, 0.03);
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: all 0.2s;
                        font-size: 16px;
                        color: transparent;
                    }

                    .toggle-square:hover {
                        background: rgba(0, 0, 0, 0.08);
                    }

                    .toggle-square.active {
                        color: white;
                    }

                    .toggle-square.active::after {
                        content: 'Ã—';
                    }

                    /* Leader - Peach */
                    .toggle-square.leader.active {
                        background: #E2B49A;
                    }

                    /* Follower - Green */
                    .toggle-square.follower.active {
                        background: #A8C6A3;
                    }

                    /* Both - Gold */
                    .toggle-square.both.active {
                        background: #DBCB96;
                    }

                    .team-content {
                        flex: 1;
                        background: var(--bg-color);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: var(--text-secondary);
                    }
                </style>
            </head>

        <body>
            <div class="top-nav">
                <div class="nav-brand">
                    <div>Warsaw Tango Partyka</div>
                    <div id="project-date" class="project-date" title="Double-click to edit">December 2025</div>
                </div>
                <div class="nav-links">
                    <a href="task-groups.html" class="nav-link">Schedule</a>
                    <a href="team.html" class="nav-link active">Team Members</a>
                </div>
            </div>

            <div class="team-container">
                <aside class="team-sidebar" id="team-sidebar-list">
                    <!-- Populated by JS -->
                </aside>

                <main class="team-content">
                    <div style="text-align: center;">
                        <h3>Team Configuration</h3>
                        <p>Manage team roles in the sidebar.</p>
                    </div>
                </main>
            </div>

            <script src="js/data.js"></script>
            <script>
                // Shared Date Logic
                function setupDateEditable() {
                    const dateEl = document.getElementById('project-date');
                    const storedDate = localStorage.getItem('project_date');
                    if (storedDate) {
                        dateEl.textContent = storedDate;
                    }

                    dateEl.addEventListener('dblclick', () => {
                        const currentText = dateEl.textContent;
                        const input = document.createElement('input');
                        input.value = currentText;

                        input.onblur = () => {
                            const newValue = input.value || 'December 2025';
                            dateEl.textContent = newValue;
                            localStorage.setItem('project_date', newValue);
                        };

                        input.onkeydown = (e) => {
                            if (e.key === 'Enter') input.blur();
                        };

                        dateEl.textContent = '';
                        dateEl.appendChild(input);
                        input.focus();
                    });
                }

                // Team Logic
                let selectedMemberId = null; // null means 'All Members'

                async function initTeamPage() {
                    setupDateEditable();

                    // Ensure data is loaded
                    if (CANDIDATES.length === 0) {
                        const stored = localStorage.getItem('spreadsheetData');
                        if (stored) {
                            const data = JSON.parse(stored);
                            CANDIDATES.push(...data.candidates);
                        } else {
                            await fetchSheetData();
                        }
                    }

                    renderTeamList();
                }

                function renderTeamList() {
                    const container = document.getElementById('team-sidebar-list');
                    container.innerHTML = '';

                    // Sticky Header (All Members)
                    const header = document.createElement('div');
                    header.className = `sidebar-header ${selectedMemberId === null ? 'selected' : ''}`;
                    header.textContent = 'All Members';
                    header.onclick = () => selectMember(null);
                    container.appendChild(header);

                    CANDIDATES.forEach(member => {
                        const item = document.createElement('div');
                        item.className = `member-item ${selectedMemberId === member.id ? 'selected' : ''}`;
                        item.onclick = (e) => {
                            // Prevent selection if clicking toggle
                            if (e.target.classList.contains('toggle-square')) return;
                            selectMember(member.id);
                        };

                        // Load saved state
                        const savedState = JSON.parse(localStorage.getItem(`team_role_${member.id}`)) || {
                            leader: false,
                            follower: false,
                            both: false
                        };

                        item.innerHTML = `
                    <div class="member-header">
                        <span class="member-name">${member.name}</span>
                        <span class="member-role">${member.role}</span>
                    </div>
                    <div class="member-controls">
                        <div class="control-col">
                            <div class="col-label">Lead</div>
                            <div class="toggle-square leader ${savedState.leader ? 'active' : ''}"
                                 onclick="toggleRole('${member.id}', 'leader')"
                                 title="Leader"></div>
                        </div>
                        <div class="control-col">
                            <div class="col-label">Follow</div>
                            <div class="toggle-square follower ${savedState.follower ? 'active' : ''}"
                                 onclick="toggleRole('${member.id}', 'follower')"
                                 title="Follower"></div>
                        </div>
                        <div class="control-col">
                            <div class="col-label">Both</div>
                            <div class="toggle-square both ${savedState.both ? 'active' : ''}"
                                 onclick="toggleRole('${member.id}', 'both')"
                                 title="Both"></div>
                        </div>
                    </div>
                `;
                        container.appendChild(item);
                    });
                }

                function selectMember(id) {
                    selectedMemberId = id;
                    renderTeamList();
                    // Here you could also update the main content area to show details for the selected member
                }

                window.toggleRole = function (memberId, role) {
                    const key = `team_role_${memberId}`;
                    let state = JSON.parse(localStorage.getItem(key)) || { leader: false, follower: false, both: false };

                    if (role === 'leader') {
                        state.leader = !state.leader;
                        if (state.leader) state.follower = false;
                    } else if (role === 'follower') {
                        state.follower = !state.follower;
                        if (state.follower) state.leader = false;
                    } else if (role === 'both') {
                        state.both = !state.both;
                    }

                    localStorage.setItem(key, JSON.stringify(state));
                    renderTeamList();
                };

                initTeamPage();
            </script>
        </body>

        </html>